<!-- Aqui começa o código inserido -->
<div class="container mt-4">
    <h1>Avisos</h1>
    <div id="provas-container" class="table-responsive" style="max-height: 600px; overflow-y: auto;">
        <!-- A tabela será preenchida dinamicamente -->
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Título</th>
                <th style="width: 100ch;">Descrição</th>
                <th>Data</th> <!-- Tipo vem antes -->
                <th>Tipo</th> <!-- Data vem depois -->
            </tr>
            </thead>
            <tbody id="provas-body">
            <!-- Aqui as provas serão inseridas dinamicamente -->
            </tbody>
        </table>
    </div>
</div>

<!-- Adicionando os scripts para WebSocket -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    // Função para conectar ao WebSocket e receber novos avisos
    function connect() {
        var socket = new SockJS('/ws'); // URL do endpoint do WebSocket no servidor
        var stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('Conectado: ' + frame);

            // Inscreva-se no tópico para receber atualizações de provas
            stompClient.subscribe('/topic/provas', function (prova) {
                var data = JSON.parse(prova.body);
                exibirAviso(data.titulo, data.descricao, data.data, data.tipo);
            });
        });
    }

    // Função para exibir o aviso (prova) dinamicamente na tabela
    function exibirAviso(titulo, descricao, data, tipo) {
        const provasBody = document.getElementById('provas-body');

        const row = document.createElement('tr');

        // Criar as colunas (td) para cada campo
        const colTitulo = document.createElement('td');
        colTitulo.textContent = titulo;

        const colDescricao = document.createElement('td');
        colDescricao.textContent = descricao;

        const colTipo = document.createElement('td');
        colTipo.textContent = tipo; // Tipo vem primeiro

        const colData = document.createElement('td');
        colData.textContent = data; // Data vem depois

        // Adicionar as colunas à linha
        row.appendChild(colTitulo);
        row.appendChild(colDescricao);
        row.appendChild(colTipo); // Coloca o tipo antes
        row.appendChild(colData); // Coloca a data depois

        // Adicionar a linha ao tbody da tabela
        provasBody.appendChild(row);
    }

    // Função para carregar as provas existentes ao carregar a página
    function carregarProvas() {
        fetch('/buscarProvasJson')
            .then(response => response.json())
            .then(data => {
                const provasBody = document.getElementById('provas-body');

                // Limpar o tbody antes de inserir novos dados
                provasBody.innerHTML = '';

                // Iterar sobre cada prova e criar uma linha para cada uma
                data.forEach(prova => {
                    exibirAviso(prova.titulo, prova.descricao, prova.tipo, prova.data); // Corrigido para tipo vir antes da data
                });
            })
            .catch(error => {
                console.error('Erro ao carregar as provas:', error);
            });
    }

    document.addEventListener("DOMContentLoaded", function() {
        connect();      // Conectar ao WebSocket
        carregarProvas();
    });
</script>

<!-- Fim do código inserido -->
</div>
